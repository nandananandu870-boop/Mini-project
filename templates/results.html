<!DOCTYPE html>
<html>
<head>
  <title>Scan Results</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; color:#222; }
    h2, h3 { margin: 8px 0; }
    table { width: 100%; border-collapse: collapse; margin-top: 14px; background:#fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; font-size:14px; }
    th { background-color: #eef2f7; }
    small { color:#555; font-style:italic; }
    .btn { margin-top: 12px; padding: 10px 14px; border: none; border-radius: 6px; cursor: pointer; font-weight:600; }
    .btn-delete { background:#e74c3c; color:#fff; }
    .panel { background:#fff; border:1px solid #e0e0e0; border-radius:8px; padding:16px; margin-top:16px; }
    .btn-smart { background:#2ecc71; color:#fff; }
    hr { margin: 24px 0; border: none; border-top:1px solid #e0e0e0; }
  </style>
</head>
<body>
  <h2>ðŸ“§ Scan Results</h2>

  <p>Fetched Emails (messages): <strong>{{ fetched }}</strong></p>
  <p>Estimated Unique Emails (messages): <strong>{{ uniques }}</strong></p>
  <p>
    Exact Duplicates (conversations): <strong>{{ exact_count }}</strong><br>
    Near Duplicates (conversations, 70â€“99%): <strong>{{ near_count }}</strong>
  </p>

  <h3>Exact Duplicates (Sender + Subject match)</h3>
  {% if duplicates and duplicates|length > 0 %}
    <form action="/delete" method="POST">
      <table>
        <tr>
          <th>Select</th>
          <th>From</th>
          <th>Subject</th>
          <th>Date</th>
        </tr>
        {% for d in duplicates %}
        <tr>
          <td><input type="checkbox" name="ids" value="{{ d.id }}"></td>
          <td>{{ d.from }}</td>
          <td>{{ d.subject }}</td>
          <td>{{ d.date }}</td>
        </tr>
        {% endfor %}
      </table>
      <small>ðŸ’¡ Selecting rows deletes only those emails (to Trash).</small><br>
      <button type="submit" class="btn btn-delete">ðŸ—‘ Delete Selected</button>
    </form>

    <div class="panel">
      <h3>ðŸ¤– Smart Delete</h3>
      <p>One-click cleanup: <strong>keeps the newest</strong> message from each exact-duplicate group and
         <strong>permanently deletes</strong> the older copies. The kept copy loses the <code>DUPLICATE</code> label.</p>
      <form action="/smart_delete" method="POST">
        <button type="submit" class="btn btn-smart">Run Smart Delete</button>
      </form>
    </div>
  {% else %}
    <p>No exact duplicates found ðŸŽ‰</p>
  {% endif %}

  <hr>

  <h3>Near Duplicates (Similarity 70â€“99% by Subject)</h3>
  {% if similars and similars|length > 0 %}
    <table>
      <tr>
        <th>From</th>
        <th>Subject 1</th>
        <th>Subject 2</th>
        <th>Similarity (%)</th>
      </tr>
      {% for pair in similars %}
      <tr>
        <td>{{ pair.email1.from }}</td>
        <td>{{ pair.email1.subject }}</td>
        <td>{{ pair.email2.subject }}</td>
        <td>{{ pair.similarity }}</td>
      </tr>
      {% endfor %}
    </table>
  {% else %}
    <p>No near duplicates found.</p>
  {% endif %}
</body>
</html>